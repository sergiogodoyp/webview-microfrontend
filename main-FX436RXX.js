import{a as m,b as l,e as c}from"./chunk-CF2I2CH5.js";function F(r,e){return{imports:m(m({},r.imports),e.imports),scopes:m(m({},r.scopes),e.scopes)}}var B="__NATIVE_FEDERATION__",I=globalThis;I[B]??={externals:new Map,remoteNamesToRemote:new Map,baseUrlToRemoteNames:new Map};var w=I[B],b=w.externals;function N(r){return`${r.packageName}@${r.version}`}function C(r){let e=N(r);return b.get(e)}function R(r,e){let t=N(r);b.set(t,e)}function $(r){let e=r.split("/");return e.pop(),e.join("/")}function y(r,e){for(;r.endsWith("/");)r=r.substring(0,r.length-1);return e.startsWith("./")&&(e=e.substring(2,e.length)),`${r}/${e}`}var P=w.remoteNamesToRemote,_=w.baseUrlToRemoteNames;function k(r,e){P.set(r,e),_.set(e.baseUrl,r)}function A(r){document.head.appendChild(Object.assign(document.createElement("script"),{type:"importmap-shim",innerHTML:JSON.stringify(r)}))}function T(){return c(this,arguments,function*(r={}){let e=typeof r=="string"?yield V(r):r,t=yield x("./remoteEntry.json"),o=yield j(t),n=yield W(e),s=F(o,n);return A(s),s})}function V(r){return c(this,null,function*(){return yield fetch(r).then(e=>e.json())})}function W(t){return c(this,arguments,function*(r,e={throwIfRemoteNotFound:!1}){let o=Object.keys(r).map(i=>c(this,null,function*(){try{let a=r[i];return yield O(a,i)}catch{let p=`Error loading remote entry for ${i} from file ${r[i]}`;if(e.throwIfRemoteNotFound)throw new Error(p);return console.error(p),null}}));return(yield Promise.all(o)).reduce((i,a)=>a?F(i,a):i,{imports:{},scopes:{}})})}function O(r,e){return c(this,null,function*(){let t=$(r),o=yield x(r);e||(e=o.name);let n=K(o,e,t);return k(e,l(m({},o),{baseUrl:t})),n})}function K(r,e,t){let o=U(r,e,t),n=D(r,t);return{imports:o,scopes:n}}function x(r){return c(this,null,function*(){return yield fetch(r).then(t=>t.json())})}function D(r,e){let t={},o={};for(let n of r.shared){let s=C(n)??y(e,n.outFileName);R(n,s),o[n.packageName]=s}return t[e+"/"]=o,t}function U(r,e,t){let o={};for(let n of r.exposes){let s=y(e,n.key),i=y(t,n.outFileName);o[s]=i}return o}function j(r,e="./"){return c(this,null,function*(){let t=r.shared.reduce((o,n)=>l(m({},o),{[n.packageName]:e+n.outFileName}),{});for(let o of r.shared)R(o,e+o.outFileName);return{imports:t,scopes:{}}})}var f=class r{MICRO_FRONTENDS_MANIFEST_IDENTIFIER="femMicroFrontendsManifest";static STORE_INSTANCE_IDENTIFIER="femMicroFrontendsManifestStore";constructor(){}static getInstance(){let e=globalThis,t=this.STORE_INSTANCE_IDENTIFIER;return e[t]||(e[t]=new r),e[t]}save(e){globalThis[this.MICRO_FRONTENDS_MANIFEST_IDENTIFIER]=e}getValue(){let e=globalThis[this.MICRO_FRONTENDS_MANIFEST_IDENTIFIER];if(!e)throw new Error("[FEM]: El micro-frontends manifest no fue encontrado.");return e}getMicroFrontendElementNameByPath(e){let{microFrontendsManifest:t}=this.getValue(),o=t.find(n=>n.path===e);if(!o||!o.elementName)throw new Error(`[FEM]: El elementName para la ruta "${e}" no fue encontrado en el micro-frontends manifest.`);return o.elementName}};var h=class r{listeners=new Map;lastEmitted=new Map;webViewListeners=[];internalTopicKey="__internal_response__";constructor(){}static getInstance(){return globalThis.femEventBusCore||(globalThis.femEventBusCore=new r),globalThis.femEventBusCore}getKey(e){return`${e.channel}::${e.topic}::${e.version}`}parseKey(e){let[t,o,n]=e.split("::");return{channel:t,topic:o,version:n}}isInternalEvent({topic:e}){return e.includes(this.internalTopicKey)}generateUUID(){let e=new Uint8Array(16);crypto.getRandomValues(e),e[6]=e[6]&15|64,e[8]=e[8]&63|128;let t=Array.from(e).map(o=>o.toString(16).padStart(2,"0"));return`${t[0]}${t[1]}${t[2]}${t[3]}-${t[4]}${t[5]}-${t[6]}${t[7]}-${t[8]}${t[9]}-${t[10]}${t[11]}${t[12]}${t[13]}${t[14]}${t[15]}`}publish(e,t,o=!1){let n=this.getKey(e);this.lastEmitted.set(n,t),this.listeners.get(n)?.forEach(s=>s(t)),!this.isInternalEvent(e)&&!o&&this.webViewListeners.forEach(s=>s(e,t))}publishAndWait(e,t){return new Promise(o=>{let n=this.generateUUID(),s=`${e.topic}${this.internalTopicKey}${n}`,i=l(m({},e),{topic:s}),a=p=>{o(p),this.off(i,a)};this.on(i,a),this.publish(e,{request:t,temporaryTopic:s,respond:p=>{this.publish(i,p)}})})}off(e,t){let o=this.getKey(e),n=this.listeners.get(o);n&&this.listeners.set(o,n.filter(s=>s!==t))}on(e,t){let o=this.getKey(e);this.lastEmitted.has(o)&&t(this.lastEmitted.get(o)),this.listeners.has(o)||this.listeners.set(o,[]),this.listeners.get(o).push(t)}onAndReply(e,t){this.on(e,t)}onWebViewListeners(e){this.webViewListeners.push(e);for(let[t,o]of this.lastEmitted.entries()){let n=this.parseKey(t);this.isInternalEvent(n)||e(n,o)}}};var g=class{detect(){if(this.isAndroid())return"android";if(this.isIos())return"ios";throw new Error("[FEM]: plataforma no soportada.")}isAndroid(){let e=navigator.userAgent||"",t=/Android.*Version\/[0-9]\.[0-9]/.test(e),o=/Android.*wv/.test(e);return!!(t||o)}isIos(){let e=navigator.userAgent||"",t=/iPhone|iPad|iPod/.test(e),o=/WebKit/.test(e),n=/Safari/.test(e);return!!(t&&o&&!n)}};var M=class{port=globalThis.femPortMessage;listen(e){this.port?this.port.onmessage=({data:t})=>{e(t)}:globalThis.addEventListener("message",t=>{this.port=t.ports[0],this.port.onmessage=({data:o})=>{e(o)}})}send(e){this.port.postMessage(e)}};var v=class{listen(e){window.receiveMessageFromiOS=t=>{e(t)}}send(e){window.webkit.messageHandlers.iosMessageHandler.postMessage(e)}};var S={android:new M,ios:new v};var E=class{platformCommunicator;constructor(){let e=new g;this.platformCommunicator=S[e.detect()]}listen(e){this.platformCommunicator.listen(e)}send(e){this.platformCommunicator.send(e)}};var d=class{webViewCommunicator=new E;eventBus=h.getInstance();temporaryEvents=[];run(){this.listenToWebViewAndEmitEventBus(),this.listenToEventBusAndSendEventMessage()}listenToWebViewAndEmitEventBus(){this.webViewCommunicator.listen(e=>{let{payload:t,channel:o,topic:n,version:s,responseExpected:i}=JSON.parse(e);i&&this.temporaryEvents.forEach(a=>{o===a.channel&&n===a.topic&&s===a.version&&(this.eventBus.publish({channel:o,topic:a.temporaryTopic,version:s},t,!0),this.removeTemporaryEventByTemporaryTopic(a.temporaryTopic))}),this.eventBus.publish({channel:o,topic:n,version:s},t,!0)})}removeTemporaryEventByTemporaryTopic(e){this.temporaryEvents=this.temporaryEvents.filter(t=>t.temporaryTopic!==e)}listenToEventBusAndSendEventMessage(){this.eventBus.onWebViewListeners(({channel:e,topic:t,version:o},n)=>{let{respond:s,temporaryTopic:i}=n,a=typeof s=="function";a&&this.temporaryEvents.push({channel:e,topic:t,version:o,temporaryTopic:i}),delete n.respond,delete n.temporaryTopic,this.webViewCommunicator.send(JSON.stringify({payload:n,channel:e,topic:t,version:o,responseExpected:a}))})}};var u=class{url;microFrontendsManifest;resolveMicroFrontendsManifest;microFrontendsManifestStore;withUrl(e){return this.url=e,this}withMicroFrontendsManifest(e){return this.microFrontendsManifest=e,this}withResolveMicroFrontendsManifest(e){return this.resolveMicroFrontendsManifest=e,this}addWebViewSupport(){return console.log(1,"addWebViewSupport"),new d().run(),this}init(){return c(this,null,function*(){let e={},t=yield this.getMicroFrontendsManifest();return e=this.transformToRemote(t),this.microFrontendsManifestStore=f.getInstance(),this.microFrontendsManifestStore.save(t),yield T(e)})}getMicroFrontendsManifest(){return c(this,null,function*(){if(this.resolveMicroFrontendsManifest)return yield this.resolveMicroFrontendsManifest();if(this.url)return yield this.fetchMicroFrontendsManifest(this.url);if(this.microFrontendsManifest)return this.microFrontendsManifest;throw new Error("[FEM]: Debe invocar al menos unos de los metodos: withUrl, withMicroFrontendsManifest o withResolveMicroFrontendsManifest antes de llamar a init().")})}transformToRemote({microFrontendsManifest:e}){let t={};return e.forEach(o=>{t[o.remoteName]=o.remoteEntry}),t}fetchMicroFrontendsManifest(e){return c(this,null,function*(){let t=yield fetch(e);if(!t.ok)throw Error(`[FEM]: Error al cargar el manifest de micro-frontends desde ${e}: ${t.statusText}`);return yield t.json()})}};var H={microFrontendsManifest:[{path:"mars",remoteName:"mars",exposedModule:"./web-components",remoteEntry:"http://localhost:4200/ng-mfe-mars/browser/remoteEntry.json",elementName:"mfe-mars",layoutPath:"solar-system",default:!0}]};new u().withMicroFrontendsManifest(H).addWebViewSupport().init().catch(r=>console.error(r)).then(r=>import("./chunk-THNEQR4S.js")).catch(r=>console.error(r));
